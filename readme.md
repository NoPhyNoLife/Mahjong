# AI Mahjong Assistant

一个快速反应的 AI 麻将助手，能够在输入当前手牌和对局进程信息后，输出建议动作（吃、碰、杠、打牌等），帮助你更好地进行麻将决策。

该项目示例使用了 Python 语言，基于启发式 + 搜索的方式来实现最初级的决策逻辑，并提供了一个可视化的 GUI 原型（基于 PyQt5）供用户友好地进行操作。

## 目录
- [功能特点](#功能特点)
- [项目结构](#项目结构)
- [安装与环境](#安装与环境)
- [语言与标记](#语言与标记)
- [快速使用](#快速使用)
  - [命令行使用](#1-命令行模式)
  - [GUI 使用（开发中）](#2-gui-使用-开发中)
- [主要模块介绍](#主要模块介绍)
  - [StateManager](#statemanager)
  - [RuleEngine](#ruleengine)
  - [DecisionMaker（开发中）](#decisionmaker-开发中)
- [后续改进思路](#后续改进思路)
- [许可证](#许可证)

## 功能特点
1. **AI 决策** *(尚未实现)*
   - 结合手牌和当前场面信息，提示吃、碰、杠、胡或打牌等最优操作（基于简单启发式算法）。
   - 提供可扩展的决策框架，后续可加入蒙特卡洛搜索或强化学习。
2. **实时应答**
   - 快速更新：玩家在输入对手出牌或自己摸牌后，系统迅速给出建议。
3. **图形界面** *(尚未实现)*
   - 使用 PyQt5 提供简单的可视化界面示例，支持鼠标点击进行出牌与操作选择。
4. **模块化设计**
   - 规则判定、数据管理、决策逻辑和 GUI 明确分离，方便后续维护和扩展。

## 项目结构

```bash
Mahjong
├── LICENSE
├── decision_maker.py
├── deck_counter.py
├── mahjongGUI.py
├── main.py
├── readme.md
├── resources
│   ├── deck
│   └── tile_codes.json
├── requirements.txt
├── rule_engine.py
├── state_manager.py
└── tile_loader.py
```

- **main.py**：命令行模式下的示例入口，接受用户输入后调用决策模块并打印结果。
- **mahjongGUI.py**：图形界面入口，启动 PyQt 窗口进行可视化交互。*(开发中)*
- **state_manager.py**：维护玩家手牌、已弃牌、风圈、剩余牌山等信息。
- **rule_engine.py**：麻将规则的判定方法，如吃、碰、杠、胡牌、向听数计算等。
- **decision_maker.py**：核心 AI 策略实现，包含候选动作生成、状态模拟、评估与选择等逻辑。*(开发中)*
- **resources/**：用于存放牌面资源，以后可在 GUI 中显示。

## 安装与环境
1. **操作系统**：Windows、macOS、Linux 均可。
2. **Python 版本**：推荐 Python 3.7 及以上。
3. **依赖安装**：

```bash
pip install -r requirements.txt
```

## 语言与标记

- **玩家方位标记**：
  - 本家：0
  - 下家：1
  - 对家：2
  - 上家：3

- **牌组及编码**：（每张牌面均有四张同样的牌）
  - **饼系列**：B1 - B9，对应 [0,1] - [0,9]
  - **万系列**：W1 - W9，对应 [1,1] - [1,9]
  - **条系列**：T1 - T9，对应 [2,1] - [2,9]
  - **字牌**：
    - 东（E）：[3,0]
    - 南（S）：[4,0]
    - 西（W）：[5,0]
    - 北（N）：[6,0]
    - 中（M）：[7,0]
    - 发（R）：[8,0]
    - 白（B）：[9,0]

详细内容可参考 `./resources` 文件夹。

## 快速使用

### 1. 命令行模式

打开命令行，进入项目根目录，运行：
```bash
python main.py
```

接下来根据提示输入对局中发生的事件等。

示例：
1. 输入初始手牌：`W1 W2 W3 T3 T4 B9 B9 N N S B B6 R`
2. 输入对手出牌：`1 T5` （表示玩家 ID=1 打出 T5）
3. 系统输出 AI 建议：`AI 建议：碰或打出 S9` *(开发中)*
4. 当前并没有结束运行的方式，可以强制关闭窗口或乱输入触发报错。

### 2. GUI 使用 *(开发中)*

同样，在根目录下运行：

```bash
python mahjongGUI.py
```

- 支持点击手牌出牌。
- 可选择“吃/碰/杠/胡”进行副露操作。
- 界面会实时刷新并显示最新 AI 建议。

## 主要模块介绍

### **StateManager**
- 功能：管理对局状态数据：我的手牌、各家弃牌、剩余牌数等。
- 常用方法：
  - `add_discard(player_id, tile)`：记录玩家弃牌。
  - 以及各种查询、修改状态等基础方法。

### **RuleEngine**
- 功能：封装麻将规则判定。
- 常用接口：
  - `can_chi(hand, tile)`：是否可以吃
  - `can_peng(hand, tile)`：是否可以碰
  - `can_gang(hand, tile, melds)`：是否可以杠
  - `can_hu(hand, tile)`：是否能胡

  在此模块中也可实现向听数、计番等进阶功能。

### **DecisionMaker** *(开发中)*
- 功能：AI 决策模块。
- 核心流程：
  1. 候选动作生成：列举吃、碰、杠、胡、或打牌等可能；
  2. 状态模拟：对每个动作做一次“假执行”，看看结果状态如何；
  3. 状态评分：通过向听数/听牌张数/番数等指标给状态打分；
  4. 最优选择：选择得分最高的动作并返回。

## 后续改进思路

1. **更强的搜索算法**：如蒙特卡洛树搜索（MCTS）。
2. **防守策略**：评估牌的危险度，避免放铳。
3. **记牌推理与牌势分析**：统计对手打牌习惯，推测可能的手牌。
4. **联机与多人对战**：支持服务器与客户端架构，实现在线麻将对战。
5. **美观的 GUI 界面**：考虑使用 Qt Quick (QML)、Unity、Godot 等。

## 许可证

本项目基于 [MIT License](./LICENSE) 开源，版权归 [NoPhyNoLife](https://github.com/nophynolife) 所有。

## 欢迎贡献

如果你对本项目有好的想法或改进，可以直接提交 Issue 或 Pull Request，一起让这个 AI 麻将助手变得更强大、更智能！

希望新的一年在开发 AI 麻将助手的道路上一切顺利！
